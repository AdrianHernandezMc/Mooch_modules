<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="custom_stock_barcode_mooch.MainComponent" t-inherit="stock_barcode.MainComponent" t-inherit-mode="extension">
        
        <!-- 1. BARRA DE TOTALES (Universal) -->
        <xpath expr="//div[contains(@class, 'o_action_buttons')]" position="before">
            <div t-if="env.model.canBeProcessed"
                 class="d-flex justify-content-center align-items-center py-2 border-top bg-100"
                 style="font-size: 1.3rem;">
                <div class="fw-bold text-primary">
                    <i class="fa fa-cubes me-2"/>
                    <span class="text-dark">Total: </span>
                    <span t-esc="totalStats.done"/>
                </div>
            </div>
        </xpath>

        <!-- ======================================================= -->
        <!-- CASO 1: TRASLADOS (stock.picking)                       -->
        <!-- ======================================================= -->

        <!-- A) Botón GUARDAR SIMPLE (Sin Popup) -->
        <xpath expr="//button[contains(@class, 'o_validate_page')]" position="before">
            <button t-if="env.model.resModel === 'stock.picking'"
                    class="btn btn-secondary me-2 text-uppercase custom_save_simple"
                    t-on-click="onSaveSimple">
                <i class="fa fa-floppy-o me-1"/>
                <span>Guardar</span>
            </button>
        </xpath>

        <!-- B) Deshabilitar VALIDAR -->
        <xpath expr="//button[contains(@class, 'o_validate_page')]" position="attributes">
            <!-- Solo deshabilitamos si es picking, aunque el botón suele ser exclusivo de picking -->
            <attribute name="t-att-disabled">env.model.resModel === 'stock.picking' ? true : false</attribute>
            <attribute name="t-attf-class">{{ env.model.resModel === 'stock.picking' ? 'btn btn-secondary o_validate_page' : 'btn btn-success o_validate_page' }}</attribute>
        </xpath>


        <!-- ======================================================= -->
        <!-- CASO 2: INVENTARIO (stock.quant)                        -->
        <!-- ======================================================= -->

        <!-- A) Botón GUARDAR CON POPUP -->
        <!-- <xpath expr="//button[contains(@class, 'o_apply_page')]" position="before">
            <button t-if="env.model.resModel === 'stock.quant'"
                    class="btn btn-secondary me-2 text-uppercase custom_save_popup"
                    t-on-click="onSaveWithPopup">
                <i class="fa fa-floppy-o me-1"/>
                <span>Guardar</span>
            </button>
        </xpath> -->

        <!-- B) Interceptar Botón APLICAR (Para pedir popup antes de validar) -->
        <xpath expr="//button[contains(@class, 'o_apply_page')]" position="attributes">
            <!-- Cambiamos el click para que pase por nuestra validación -->
            <attribute name="t-on-click">onApplyWithPopup</attribute>
        </xpath>

    </t>

</templates>