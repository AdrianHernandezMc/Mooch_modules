<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <t t-name="point_of_sale.SaleDetailsReport" t-inherit="point_of_sale.SaleDetailsReport" t-inherit-mode="extension">
        
        <xpath expr="//div[@class='pos-receipt']" position="replace">
            <div class="pos-receipt" style="font-family: 'Courier New', monospace; font-size: 16px; line-height: 1.1; font-weight: bold; color: #000; width: 90mm; max-width: 100%; margin: 0 auto;">

                <!-- 1. ENCABEZADO -->
                <div style="text-align: center;">
                    <t t-if="pos.company_logo_base64">
                        <img t-att-src="pos.company_logo_base64" style="max-width: 50%; max-height: 70px; filter: grayscale(100%) contrast(150%); margin-bottom: 5px;"/>
                        <br/>
                    </t>
                    <div style="font-size: 26px; font-weight: 900; margin-top:2px;">
                        <t t-esc="pos.company.name" />
                    </div>
                    <div style="font-size: 24px; border: 3px solid black; padding: 3px; margin: 5px 0;">
                        <t t-if="is_z_report">CORTE FINAL (Z)</t>
                        <t t-else="">CORTE DE CAJA (X)</t>
                    </div>
                    <div style="font-size: 20px; text-align: left; margin-bottom: 5px;">
                        <div>üìÖ <t t-esc="date" /></div>
                        <div>üë§ <t t-esc="user_name || 'Cajero'" /></div>
                        <div>üè™ <t t-esc="pos.config.name" /></div>
                        <div>üî¢ Sesi√≥n: <t t-esc="session_name" /></div>
                        <div>üßæ Ordenes: <t t-esc="orders_count || 0" /></div>
                    </div>
                </div>

                <!-- 2. RESUMEN VENTA -->
                <div style="border-bottom: 2px solid black; margin-bottom: 3px;"></div>
                <div style="font-size: 24px; text-align: center;">RESUMEN VENTA</div>
                <div style="border-bottom: 2px solid black; margin-bottom: 5px;"></div>
                
                <t t-foreach="payments" t-as="payment" t-key="payment_index">
                    <div style="display: flex; justify-content: space-between; font-size: 20px">
                        <span t-esc="payment['name'].substr(0,12)" />
                        <span t-esc="formatCurrency(payment['total'] || 0, false)" />
                    </div>
                </t>
                
                <div style="border-top: 1px dashed black; margin-top: 5px; margin-bottom: 5px;"></div>

                <!-- SOLO TOTAL -->
                <div style="border-top: 3px solid black; margin-top: 3px; padding-top: 2px; display: flex; justify-content: space-between; font-size: 24px; font-weight: 900;">
                    <span>TOTAL:</span>
                    <span t-esc="formatCurrency(total_products_incl || 0, false)" />
                </div>
                <br/>

                <!-- 3. DEDUCCIONES VENTA -->
                <div style="border-bottom: 2px solid black; margin-bottom: 3px;"></div>
                <div style="font-size: 24px; text-align: center;">DEDUCCIONES</div>
                <div style="border-bottom: 2px solid black; margin-bottom: 5px;"></div>
                
                <div style="display: flex; justify-content: space-between; font-size: 20px;">
                    <span>DEVOLUCIONES:</span>
                    <span t-esc="formatCurrency(dev_total || 0, false)"/>
                </div>
                
                <div style="display: flex; justify-content: space-between; font-size: 20px;">
                    <span>DESCUENTOS:</span>
                    <span t-esc="formatCurrency(disc_total || 0, false)"/>
                </div>
                
                <div style="border-top: 1px dashed black; margin-top: 5px; margin-bottom: 5px;"></div>
                
                <!-- SOLO TOTAL -->
                <div style="border-top: 3px solid black; margin-top: 3px; padding-top: 2px; display: flex; justify-content: space-between; font-size: 24px; font-weight: 900;">
                    <span>TOTAL DEDUCCIONES:</span>
                    <span t-esc="formatCurrency(deduction_total || 0, false)"/>
                </div>
                <br/>

                <!-- 4. MOVIMIENTOS CAJA -->
                <div style="border-bottom: 2px solid black; margin-bottom: 3px;"></div>
                <div style="font-size: 24px; text-align: center;">MOVIMIENTOS CAJA</div>
                <div style="border-bottom: 2px solid black; margin-bottom: 5px;"></div>
                
                <!-- ENTRADAS -->
                <div style="font-size: 20px; margin-bottom: 2px;">(+) INGRESOS</div>
                
                <t t-if="moves_info">
                    <t t-foreach="moves_info" t-as="move" t-key="move_index">
                        <t t-if="move and move['amount'] and move['amount'] &gt; 0">
                            <div style="display: flex; justify-content: space-between; font-size: 20px;">
                                <span style="flex: 1;">
                                    <t t-esc="(move['name'] || 'Movimiento').substr(0,25)"/>
                                </span>
                                <span><t t-esc="formatCurrency(move['amount'], false)"/></span>
                            </div>
                        </t>
                    </t>
                </t>
                
                <div style="border-top: 1px dashed black; margin-top: 2px;"></div>
                <div style="text-align: right; font-size: 20px; font-weight: bold; margin-bottom: 5px;">
                    Total: <span t-esc="formatCurrency(summary_entradas || 0, false)"/>
                </div>

                <!-- SALIDAS -->
                <div style="font-size: 20px; margin-bottom: 2px;">(-) RETIROS</div>
                
                <t t-if="moves_info">
                    <t t-foreach="moves_info" t-as="move" t-key="move_index">
                        <t t-if="move and move['amount'] and move['amount'] &lt; 0">
                            <div style="display: flex; justify-content: space-between; font-size: 20px;">
                                <span style="flex: 1;">
                                    <t t-esc="(move['name'] || 'Retiro').substr(0,25)"/>
                                </span>
                                <span><t t-esc="formatCurrency(move['amount'], false)"/></span>
                            </div>
                        </t>
                    </t>
                </t>
                
                <div style="border-top: 1px dashed black; margin-top: 2px;"></div>
                <div style="text-align: right; font-size: 20px; font-weight: bold;">
                    Total: <span t-esc="formatCurrency((summary_salidas || 0) * -1, false)"/>
                </div>
                
                <br/><br/>

                <div style="text-align: center; font-size: 18px;">
                    === FIN DEL REPORTE ===
                </div>
            </div>
        </xpath>
    </t>
</templates>