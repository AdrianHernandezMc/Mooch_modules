<?xml version="1.0" encoding="UTF-8"?>
<templates id="pos_txid_templates" xml:space="preserve">
  <!-- Inserta el input antes del componente de l√≠neas de pago t.credito,t.debito -->
    <t t-inherit="point_of_sale.PaymentScreenMethods" t-inherit-mode="extension" owl="1">
        <xpath expr="//PaymentScreenPaymentLines" position="before">
            <t t-if="requiresTxId">
            <div class="o_pos_txid_box d-flex ">
              <label class="small text-muted">Transaction ID</label>
              <input type="text"
                      class="form-control form-control-sm"
                      placeholder="Terminacion de la Tarjeta"
                      t-on-input="onTxInput"
                      t-att-value="(selectedPaymentLine and selectedPaymentLine.transaction_id) or ''"/>
            </div>
          </t>
        </xpath>
    </t>
  <!-- Cambio la palabra validar por Finalizar compra -->
    <t t-inherit="point_of_sale.PaymentScreenValidate" t-inherit-mode="extension">
        <!-- Versi√≥n m√≥vil/small -->
        <xpath expr="//button[contains(@class,'validation-button')]//span[normalize-space()='Validate']" position="replace">
          <span>Finalizar compra</span>
        </xpath>
        <!-- Versi√≥n desktop -->
        <xpath expr="//div[contains(@class,'button') and contains(@class,'validation')]//span[contains(@class,'next_text') and normalize-space()='Validate']" position="replace">
          <span class="next_text">Finalizar compra</span>
        </xpath>
    </t>
    <!-- Vistas para cajas de muebles/hogar-->
    <!--Validacion si entra al llenar entrega a domicilio.  -->
    <t t-name="custom_point_of_sale_mooch.DeliveryConfirmationPopup">
        <div class="o_delivery_confirmation_popup o_pos_popup">
            <div class="o_popup_header">
                <h3>üöö Entrega a Domicilio</h3>
            </div>
            <div class="o_popup_body">
                <div class="confirmation-content">
                    <div class="icon-section">
                        <div class="delivery-icon">üì¶</div>
                    </div>
                    <div class="message-section">
                        <h4>¬øDeseas agregar direcci√≥n de entrega?</h4>
                        <p>Si el pedido es para entrega a domicilio, podr√°s capturar los datos de ubicaci√≥n y contacto.</p>
                    </div>
                </div>
            </div>

            <div class="o_popup_footer">
                <div class="footer-actions">
                  <button class="btn btn-confirm" t-on-click="confirmDelivery">‚úÖ <br/>S√≠, Agregar Direcci√≥n</button>
                  <button class="btn btn-skip" t-on-click="skipDelivery">‚û°Ô∏è <br/>Saltar Entrega</button>
                  <button class="btn btn-cancel" t-on-click="cancel">‚ùå <br/>Cancelar</button>
                </div>
            </div>
        </div>
    </t>
    <!-- Template para el Popup de Entrega a Domicilio -->
    <t t-name="custom_point_of_sale_mooch.HomeDeliveryPopup">
        <div class="o_home_delivery_popup o_pos_popup large-popup">
            <div class="o_popup_header">
                <h3>üöö Entrega a Domicilio</h3>
                <p class="popup-subtitle">Configura los detalles de entrega para el pedido</p>
            </div>

            <div class="o_popup_body">
                <div class="popup-layout">
                    <!-- Columna izquierda: Formulario -->
                    <div class="form-column">
                        <t t-if="state.loading_partner_data">
                            <div class="loading-partner-data">
                                <div class="small-spinner"></div>
                                <span>üì° Cargando datos de entrega del cliente...</span>
                            </div>
                        </t>
                        
                        <!-- SECCI√ìN z: UBICACI√ìN -->
                        <div class="form-section">
                            <h4>üìç Ubicaci√≥n de Entrega</h4>

                            <!-- BUSCADOR GENERAL (AUTOCOMPLETE) -->
                            <div class="address-search">
                                <label>Buscar Direcci√≥n General:</label>
                                <div class="search-container">
                                    <input type="text"
                                           id="address-input"
                                           t-model="state.address"
                                           placeholder="Ej: Av Vallarta 2440, Guadalajara"
                                           class="form-input search-input"/>
                                    <button class="btn btn-search" t-on-click="searchAddress" title="Buscar">üîç</button>
                                </div>
                            </div>

                            <!-- ‚úÖ NUEVA SECCI√ìN: CAMPOS DETALLADOS (BIDIRECCIONAL) -->
                            <!-- ‚úÖ SECCI√ìN DE DESGLOSE CON LISTA DE MUNICIPIOS DE JALISCO -->
                            <div class="detailed-address-section" style="margin-top: 15px; background: #f9f9f9; padding: 10px; border-radius: 5px; border: 1px solid #ddd;">
                                <h5 style="margin-bottom: 10px; font-size: 0.9em; color: #666; font-weight: bold;">üìù Editar Detalles (Manual)</h5>

                                <!-- Fila 1: Calle y N√∫mero -->
                                <div class="form-grid-row" style="display: flex; gap: 10px; margin-bottom: 8px;">
                                    <div style="flex: 2;">
                                        <label class="small-label">Calle:</label>
                                        <input type="text"
                                               t-model="state.street"
                                               t-on-change="updateFromSpecificFields"
                                               class="form-input form-control-sm"
                                               placeholder="Calle"/>
                                    </div>
                                    <div style="flex: 1;">
                                        <label class="small-label">N√∫mero:</label>
                                        <input type="text"
                                               t-model="state.street_number"
                                               t-on-change="updateFromSpecificFields"
                                               class="form-input form-control-sm"
                                               placeholder="#"/>
                                    </div>
                                </div>

                                <!-- Fila 2: Colonia y CP -->
                                <div class="form-grid-row" style="display: flex; gap: 10px; margin-bottom: 8px;">
                                    <div style="flex: 2;">
                                        <label class="small-label">Colonia:</label>
                                        <input type="text"
                                               t-model="state.colonia"
                                               t-on-change="updateFromSpecificFields"
                                               class="form-input form-control-sm"
                                               placeholder="Colonia"/>
                                    </div>
                                    <div style="flex: 1;">
                                        <label class="small-label">C.P.:</label>
                                        <input type="text"
                                               t-model="state.zip"
                                               t-on-change="updateFromSpecificFields"
                                               class="form-input form-control-sm"
                                               placeholder="CP"/>
                                    </div>
                                </div>

                                <!-- Fila 3: Municipio (Con Lista JALISCO) -->
                                <div class="form-grid-row" style="display: flex; gap: 10px;">
                                    <div style="flex: 1;">
                                        <label class="small-label">Municipio / Ciudad:</label>
                                        <input type="text"
                                            t-model="state.city"
                                            list="municipios_jalisco_list"
                                            t-on-change="updateFromSpecificFields"
                                            class="form-input form-control-sm"
                                            placeholder="Selecciona municipio..."/>

                                        <!-- ‚úÖ Generaci√≥n din√°mica y limpia -->
                                        <datalist id="municipios_jalisco_list">
                                            <!-- Puedes poner los principales primero manualmente si quieres -->
                                            <option value="Tlajomulco de Z√∫√±iga"/>
                                            <option value="Guadalajara"/>
                                            <option value="Zapopan"/>

                                            <!-- El resto se genera desde el JS -->
                                            <t t-foreach="municipiosList" t-as="municipio" t-key="municipio">
                                                <option t-att-value="municipio"/>
                                            </t>
                                        </datalist>
                                    </div>
                                </div>
                            </div>
                            <!-- FIN NUEVA SECCI√ìN -->

                            <div class="coordinates-display" style="margin-top: 15px;">
                                <div class="coordinate-group">
                                    <label>Latitud:</label>
                                    <input type="text" t-model="state.lat" readonly="readonly" class="form-input coordinate-input"/>
                                </div>
                                <div class="coordinate-group">
                                    <label>Longitud:</label>
                                    <input type="text" t-model="state.lng" readonly="readonly" class="form-input coordinate-input"/>
                                </div>

                                <t t-if="state.reverse_geocoding">
                                    <div class="geocoding-status">
                                        <div class="small-spinner"></div>
                                        <span>Actualizando mapa...</span>
                                    </div>
                                </t>
                            </div>

                            <div class="location-actions">
                                <button class="btn btn-location" t-on-click="useMyLocation" t-att-disabled="state.searching_address">
                                    <t t-if="state.searching_address">Buscando...</t>
                                    <t t-else="">üìç Usar Mi Ubicaci√≥n Actual</t>
                                </button>
                            </div>
                        </div>

                        <!-- SECCI√ìN 2: CONTACTO  -->
                        <div class="form-section">
                            <h4>üë§ Informaci√≥n de Contacto</h4>
                            <div class="form-grid">
                                <label>Nombre del Contacto:</label>
                                <input type="text" t-model="state.contact_name" placeholder="Persona que recibir√° el pedido" class="form-input"/>

                                <label>üìû Tel√©fono:</label>
                                <input type="text" t-model="state.phone" placeholder="N√∫mero de contacto" class="form-input"/>

                                <label>üìù Notas / Referencias:</label>
                                <textarea t-model="state.notes" placeholder="Entre calles, color de fachada, indicaciones..." class="form-textarea"></textarea>
                            </div>
                        </div>

                    </div>

                    <!-- Columna derecha: Mapa  -->
                    <div class="map-column">
                        <div class="map-section">
                            <h4>üó∫Ô∏è Mapa de Entrega</h4>
                            <div class="map-container">
                                <div id="delivery-map" class="delivery-map">
                                    <t t-if="!state.map_loaded">
                                        <div class="map-loading"><p>Cargando mapa...</p></div>
                                    </t>
                                </div>
                            </div>
                            <div class="map-tips">
                                <p class="text-muted small">Al editar Calle o N√∫mero, presiona Enter o haz clic fuera para actualizar el mapa.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="o_popup_footer">
                <div class="footer-actions">
                    <button class="btn btn-cancel" t-on-click="cancel">‚ùå Cancelar</button>
                    <button class="btn btn-confirm" t-on-click="confirm">‚úÖ Confirmar Entrega</button>
                    <button class="btn btn-report" t-on-click="generateReport">üñ®Ô∏è Imprimir</button>
                </div>
            </div>
        </div>
    </t>
</templates>