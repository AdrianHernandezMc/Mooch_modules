<?xml version="1.0" encoding="UTF-8"?>
<templates id="pos_txid_templates" xml:space="preserve">
  <!-- Inserta el input antes del componente de l√≠neas de pago t.credito,t.debito -->
    <t t-inherit="point_of_sale.PaymentScreenMethods" t-inherit-mode="extension" owl="1">
        <xpath expr="//PaymentScreenPaymentLines" position="before">
            <t t-if="requiresTxId">
            <div class="o_pos_txid_box d-flex ">
              <label class="small text-muted">Transaction ID</label>
              <input type="text"
                      class="form-control form-control-sm"
                      placeholder="Terminacion de la Tarjeta"
                      t-on-input="onTxInput"
                      t-att-value="(selectedPaymentLine and selectedPaymentLine.transaction_id) or ''"/>
            </div>
          </t>
        </xpath>
    </t>
    <t t-name="custom_point_of_sale_mooch.HomeDeliveryPopup">
        <div class="o_home_delivery_popup o_pos_popup large-popup">
            <div class="o_popup_header">
                <h3><t t-esc="props.title"/></h3>
                <p class="popup-subtitle"><t t-esc="props.body"/></p>
            </div>

            <div class="o_popup_body">
                <div class="popup-layout">
                    <!-- Columna izquierda: Formulario -->
                    <div class="form-column">
                        <div class="form-section">
                            <h4>Informaci√≥n de Contacto</h4>
                            <div class="form-grid">
                                <label>Nombre del Contacto:</label>
                                <input type="text" t-model="state.contact_name" placeholder="Persona que recibir√° el pedido" class="form-input"/>

                                <label>Tel√©fono:</label>
                                <input type="text" t-model="state.phone" placeholder="N√∫mero de contacto" class="form-input"/>

                                <label>Notas de Entrega:</label>
                                <textarea t-model="state.notes" placeholder="Indicaciones especiales, horarios preferidos, referencias, etc." class="form-textarea"></textarea>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>Ubicaci√≥n de Entrega</h4>

                            <div class="address-search">
                                <label>Buscar Direcci√≥n:</label>
                                <div class="search-container">
                                    <input type="text" id="address-input" placeholder="Escribe la direcci√≥n completa..." class="form-input search-input"/>
                                    <button class="btn btn-search" t-on-click="searchAddress">üîç</button>
                                </div>
                            </div>

                            <!-- Direcci√≥n obtenida autom√°ticamente -->
                            <div class="form-grid">
                                <label>Direcci√≥n Completa:</label>
                                <input type="text" t-model="state.address" placeholder="La direcci√≥n se llenar√° autom√°ticamente..." readonly="readonly" class="form-input address-display"/>
                            </div>

                            <div class="coordinates-display">
                                <div class="coordinate-group">
                                    <label>Latitud:</label>
                                    <input type="text" t-model="state.lat" readonly="readonly" class="form-input coordinate-input"/>
                                </div>
                                <div class="coordinate-group">
                                    <label>Longitud:</label>
                                    <input type="text" t-model="state.lng" readonly="readonly" class="form-input coordinate-input"/>
                                </div>

                                <!-- ‚úÖ INDICADOR DE REVERSE GEOCODING -->
                                <t t-if="state.reverse_geocoding">
                                    <div class="geocoding-status">
                                        <div class="geocoding-loading">
                                            <div class="small-spinner"></div>
                                            <span>Obteniendo direcci√≥n...</span>
                                        </div>
                                    </div>
                                </t>
                                <t t-elif="state.lat and state.lng and state.address">
                                    <div class="geocoding-status success">
                                        <span>‚úÖ Direcci√≥n obtenida</span>
                                    </div>
                                </t>
                            </div>

                            <div class="location-actions">
                                <button class="btn btn-location" t-on-click="useMyLocation" t-att-disabled="state.searching_address">
                                    <t t-if="state.searching_address">Buscando...</t>
                                    <t t-else="true">üìç Usar Mi Ubicaci√≥n Actual</t>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Columna derecha: Mapa -->
                    <div class="map-column">
                        <div class="map-section">
                            <h4>Selecciona la Ubicaci√≥n en el Mapa</h4>
                            <p class="map-instructions">Haz clic en el mapa para marcar la ubicaci√≥n exacta de entrega</p>

                            <div class="map-container">
                                <div id="delivery-map" class="delivery-map">
                                    <t t-if="!state.map_loaded">
                                        <div class="map-loading">
                                            <div class="loading-spinner"></div>
                                            <p>Cargando mapa...</p>
                                        </div>
                                    </t>
                                    <t t-elif="!props.config?.google_maps_api_key">
                                        <div class="no-api-key-message">
                                            <h5>‚ö†Ô∏è Google Maps no configurado</h5>
                                            <p>Configura la API Key de Google Maps en la configuraci√≥n del POS para usar el mapa interactivo.</p>
                                            <p>Puedes continuar ingresando la direcci√≥n manualmente.</p>
                                        </div>
                                    </t>
                                </div>
                            </div>

                            <div class="map-tips">
                                <p>üí° <strong>Tips:</strong> Arrastra el marcador o haz clic en el mapa para ajustar la ubicaci√≥n</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="o_popup_footer">
                <div class="footer-actions">
                    <button class="btn btn-cancel" t-on-click="cancel">Cancelar Pedido</button>
                    <button class="btn btn-confirm" t-on-click="confirm">‚úÖ Confirmar Entrega y Continuar</button>
                </div>
            </div>
        </div>
    </t>
</templates>