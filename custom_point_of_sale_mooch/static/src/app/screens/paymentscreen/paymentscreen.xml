<?xml version="1.0" encoding="UTF-8"?>
<templates id="pos_txid_templates" xml:space="preserve">
  <!-- Inserta el input antes del componente de l√≠neas de pago t.credito,t.debito -->
    <t t-inherit="point_of_sale.PaymentScreenMethods" t-inherit-mode="extension" owl="1">
        <xpath expr="//PaymentScreenPaymentLines" position="before">
            <t t-if="requiresTxId">
            <div class="o_pos_txid_box d-flex ">
              <label class="small text-muted">Transaction ID</label>
              <input type="text"
                      class="form-control form-control-sm"
                      placeholder="Terminacion de la Tarjeta"
                      t-on-input="onTxInput"
                      t-att-value="(selectedPaymentLine and selectedPaymentLine.transaction_id) or ''"/>
            </div>
          </t>
        </xpath>
    </t>
    <!-- Template para el Popup de Entrega a Domicilio -->
    <t t-name="custom_point_of_sale_mooch.HomeDeliveryPopup">
        <div class="o_home_delivery_popup o_pos_popup large-popup">
            <div class="o_popup_header">
                <h3>üöö Entrega a Domicilio</h3>
                <p class="popup-subtitle">Configura los detalles de entrega para el pedido</p>
            </div>

            <div class="o_popup_body">
                <div class="popup-layout">
                    <!-- Columna izquierda: Formulario -->
                    <div class="form-column">
                        <div class="form-section">
                            <h4>üë§ Informaci√≥n de Contacto</h4>
                            <div class="form-grid">
                                <label>Nombre del Contacto:</label>
                                <input type="text" 
                                       t-model="state.contact_name" 
                                       placeholder="Persona que recibir√° el pedido" 
                                       class="form-input"/>

                                <label>üìû Tel√©fono:</label>
                                <input type="text" 
                                       t-model="state.phone" 
                                       placeholder="N√∫mero de contacto" 
                                       class="form-input"/>

                                <label>üìù Notas de Entrega:</label>
                                <textarea t-model="state.notes" 
                                          placeholder="Indicaciones especiales, horarios preferidos, referencias, etc." 
                                          class="form-textarea"></textarea>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>üìç Ubicaci√≥n de Entrega</h4>

                            <div class="address-search">
                                <label>Buscar Direcci√≥n en Google Maps:</label>
                                <div class="search-container">
                                    <input type="text" 
                                           id="address-input" 
                                           t-model="state.address"
                                           placeholder="Escribe la direcci√≥n completa..." 
                                           class="form-input search-input"/>
                                    <button class="btn btn-search" 
                                            t-on-click="searchAddress"
                                            title="Buscar en Google Maps">üîç</button>
                                </div>
                                <small class="text-muted">
                                    üí° Escribe la direcci√≥n y haz clic en la lupa para buscarla en Google Maps
                                </small>
                            </div>

                            <div class="coordinates-display">
                                <div class="coordinate-group">
                                    <label>Latitud:</label>
                                    <input type="text" 
                                           t-model="state.lat" 
                                           readonly="readonly" 
                                           class="form-input coordinate-input"/>
                                </div>
                                <div class="coordinate-group">
                                    <label>Longitud:</label>
                                    <input type="text" 
                                           t-model="state.lng" 
                                           readonly="readonly" 
                                           class="form-input coordinate-input"/>
                                </div>

                                <!-- Indicador de Reverse Geocoding -->
                                <t t-if="state.reverse_geocoding">
                                    <div class="geocoding-status">
                                        <div class="geocoding-loading">
                                            <div class="small-spinner"></div>
                                            <span>Obteniendo direcci√≥n...</span>
                                        </div>
                                    </div>
                                </t>
                                <t t-elif="state.lat and state.lng and state.address">
                                    <div class="geocoding-status success">
                                        <span>‚úÖ Direcci√≥n obtenida</span>
                                    </div>
                                </t>
                            </div>

                            <div class="location-actions">
                                <button class="btn btn-location" 
                                        t-on-click="useMyLocation" 
                                        t-att-disabled="state.searching_address">
                                    <t t-if="state.searching_address">
                                        <div class="small-spinner"></div>
                                        Buscando ubicaci√≥n...
                                    </t>
                                    <t t-else="">
                                        üìç Usar Mi Ubicaci√≥n Actual
                                    </t>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Columna derecha: Mapa -->
                    <div class="map-column">
                        <div class="map-section">
                            <h4>üó∫Ô∏è Mapa de Entrega</h4>
                            <p class="map-instructions">Haz clic en el mapa o arrastra el marcador para seleccionar la ubicaci√≥n exacta</p>

                            <div class="map-container">
                                <div id="delivery-map" class="delivery-map">
                                    <t t-if="!state.map_loaded">
                                        <div class="map-loading">
                                            <div class="loading-spinner"></div>
                                            <p>Cargando mapa...</p>
                                        </div>
                                    </t>
                                    <t t-elif="!props.config?.google_maps_api_key">
                                        <div class="no-api-key-message">
                                            <h5>‚ö†Ô∏è Google Maps no configurado</h5>
                                            <p>Configura la API Key de Google Maps en la configuraci√≥n del POS para usar el mapa interactivo.</p>
                                            <p>Puedes continuar ingresando la direcci√≥n manualmente.</p>
                                        </div>
                                    </t>
                                </div>
                            </div>

                            <div class="map-tips">
                                <p>üí° <strong>Tips:</strong><br/>
                                ‚Ä¢ Haz clic en el mapa para colocar el marcador<br/>
                                ‚Ä¢ Arrastra el marcador para ajustar la ubicaci√≥n<br/>
                                ‚Ä¢ Usa "Mi Ubicaci√≥n" para ubicarte autom√°ticamente</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="o_popup_footer">
                <div class="footer-actions">
                    <button class="btn btn-cancel" t-on-click="cancel">‚ùå Cancelar</button>
                    <button class="btn btn-confirm" t-on-click="confirm">‚úÖ Confirmar Entrega</button>
                </div>
            </div>
        </div>
    </t>
</templates>